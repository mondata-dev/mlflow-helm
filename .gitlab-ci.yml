image: dtzar/helm-kubectl:3.11.2

stages:
  - build

build:
  stage: build
  script:
    - helm package mlflow
    - |-
      curl \
        --request POST \
        --user gitlab-ci-token:$CI_JOB_TOKEN \
        --form "chart=@mlflow-${CI_COMMIT_TAG}.tgz" \
        "${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/helm/api/stable/charts"
  only:
    - tags
